import{q as _,b as j,j as r,r as k,a as c}from"./app-4a17Pub4.js";import{o as C}from"./ConfirmModal-gDH_QAL7.js";import{c as m,D as S,a as v}from"./TaskDrawer.module-YBHG2sMu.js";import{R as D}from"./RichTextEditor-Cn3FPVCj.js";import{u as T}from"./useTaskDrawerStore-6UMOKvwU.js";import{u as w}from"./useForm-D-7B7N6w.js";import{h as N}from"./user-IyQLa11_.js";import y from"./LabelsDropdown-Db3CEi_I.js";import{D as A}from"./Drawer-49D35R63.js";import{T as F}from"./Text-BR9LnClf.js";import{T as M}from"./TextInput-h0GXyFQ7.js";import{M as P}from"./MultiSelect-Duq5FJlZ.js";import{F as E}from"./Flex-C4-MgrqI.js";import{S as u}from"./Select-B1v7hLJR.js";import{N as R}from"./NumberInput-DH4hLPlt.js";import{C as h}from"./Checkbox-CVY_-4jR.js";import"./file-D4aCAaTQ.js";import"./upper-first-sQkIoMXG.js";import"./use-resolved-styles-api-nyfOONey.js";import"./use-disclosure-CdCiEhD4.js";import"./IconCircleX-irk6tkAo.js";import"./createReactComponent-BwHUzXp6.js";import"./Image-BIx1LFvX.js";import"./Center-CanggSuC.js";import"./IconX-DRbAGJ5J.js";import"./SimpleGrid-D_xH_exl.js";import"./get-sorted-breakpoints-RaBjtxFS.js";import"./get-base-value-JqT_q0U7.js";import"./pick-calendar-levels-props-4bDM8Nej.js";import"./use-uncontrolled-BGuEEBtS.js";import"./AccordionChevron-CiAWs_wK.js";import"./clamp-DTmYCdls.js";import"./InputBase-DVeQGwl5.js";import"./Input-B6kN7ymh.js";import"./create-optional-context-DejgPxvx.js";import"./Popover-CBbffI_i.js";import"./DirectionProvider-DqDMRz46.js";import"./use-floating-auto-update-BytyxRVS.js";import"./use-computed-color-scheme-BjX3e8Yz.js";import"./Tooltip-Bs0FEF2V.js";import"./get-style-object-DUJZA7T_.js";import"./ColorSwatch-HXcgr9nk.js";import"./ColorPicker-C94QZAI7.js";import"./ActionIcon-ni5mTX2i.js";import"./route-CLXYwALx.js";import"./_baseClone-DIFX3Exu.js";import"./index-C163xbN1.js";import"./index-B6r_j4C5.js";import"./Label-CpZa6cUd.js";import"./Combobox-Bd-ojIJS.js";import"./PillsInput-B9htvQA-.js";import"./Pill-BLrl2ix2.js";import"./CheckIcon-BVmRy-LG.js";import"./OptionsDropdown-B7k9BRCW.js";import"./ScrollArea-BBLLgi1y.js";import"./get-auto-contrast-value-Da6zqqWm.js";function ze(){const{create:o,closeCreateTask:n}=T(),{usersWithAccessToProject:l,taskGroups:b,labels:g,auth:{user:d}}=_().props,s={group_id:o.group_id?o.group_id.toString():"",assigned_to_user_id:"",name:"",description:"",estimation:"",due_on:"",hidden_from_clients:!1,billable:!0,subscribed_users:[d.id.toString()],labels:[],attachments:[]},[t,f,a]=w("post",route("projects.tasks.store",[route().params.project]),{...s});j.useEffect(()=>{a({...s})},[o.opened]);const i=(e=!1)=>{e||JSON.stringify(t.data)===JSON.stringify(s)&&!t.processing?n():C({type:"danger",title:"Discard changes?",content:"All unsaved changes will be lost.",confirmLabel:"Discard",confirmProps:{color:"red"},onConfirm:()=>n()})},x=e=>{const p=[...t.data.attachments];p.splice(e,1),a("attachments",p)};return r.jsx(A,{opened:o.opened,onClose:i,title:r.jsx(F,{fz:k(28),fw:600,ml:25,my:"sm",children:"Add new task"}),position:"right",size:1e3,overlayProps:{backgroundOpacity:.55,blur:3},transitionProps:{transition:"slide-left",duration:400,timingFunction:"ease"},children:r.jsxs("form",{onSubmit:e=>f(e,{onSuccess:()=>i(!0),forceFormData:!0}),className:m.inner,children:[r.jsxs("div",{className:m.content,children:[r.jsx(M,{label:"Name",placeholder:"Task name",required:!0,"data-autofocus":!0,value:t.data.name,onChange:e=>a("name",e.target.value),error:t.errors.name}),r.jsx(D,{mt:"xl",placeholder:"Task description",height:260,onChange:e=>a("description",e)}),r.jsx(S,{mt:"xl",selected:t.data.attachments,onChange:e=>a("attachments",e),remove:e=>x(e)}),r.jsx(P,{label:"Subscribers",placeholder:"Select subscribers",searchable:!0,mt:"md",value:t.data.subscribed_users,onChange:e=>a("subscribed_users",e),data:l.map(e=>({value:e.id.toString(),label:e.name})),error:t.errors.subscribed_users}),r.jsxs(E,{justify:"space-between",mt:"xl",children:[r.jsx(c,{variant:"transparent",w:100,disabled:t.processing,onClick:i,children:"Cancel"}),r.jsx(c,{type:"submit",w:120,loading:t.processing,children:"Add task"})]})]}),r.jsxs("div",{className:m.sidebar,children:[r.jsx(u,{label:"Task group",placeholder:"Select task group",required:!0,value:t.data.group_id,onChange:e=>a("group_id",e),data:b.map(e=>({value:e.id.toString(),label:e.name})),error:t.errors.group_id}),r.jsx(u,{label:"Assignee",placeholder:"Select assignee",searchable:!0,mt:"md",value:t.data.assigned_to_user_id,onChange:e=>a("assigned_to_user_id",e),data:l.map(e=>({value:e.id.toString(),label:e.name})),error:t.errors.assigned_to_user_id}),r.jsx(v,{clearable:!0,valueFormat:"DD MMM YYYY",minDate:new Date,mt:"md",label:"Due date",placeholder:"Pick task due date",value:t.data.due_on,onChange:e=>a("due_on",e)}),r.jsx(y,{items:g,selected:t.data.labels,onChange:e=>a("labels",e),mt:"md"}),r.jsx(R,{label:"Time estimation",mt:"md",decimalScale:2,fixedDecimalScale:!0,defaultValue:0,min:0,allowNegative:!1,step:.5,suffix:" hours",onChange:e=>a("estimation",e)}),r.jsx(h,{label:"Billable",mt:"xl",checked:t.data.billable,onChange:e=>a("billable",e.currentTarget.checked)}),!N(d,["client"])&&r.jsx(h,{label:"Hidden from clients",mt:"md",checked:t.data.hidden_from_clients,onChange:e=>a("hidden_from_clients",e.currentTarget.checked)})]})]})})}export{ze as CreateTaskDrawer};
